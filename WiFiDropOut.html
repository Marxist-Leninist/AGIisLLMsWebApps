<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>WiFi Connection Dropout and Distance Monitor</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #status { font-size: 1.5em; margin-bottom: 20px; }
    #log { border: 1px solid #ccc; padding: 10px; height: 200px; overflow-y: scroll; }
    .online { color: green; }
    .offline { color: red; }
  </style>
</head>
<body>
  <h1>WiFi Connection Dropout and Distance Monitor</h1>
  <div id="status">Checking connection...</div>
  <div id="log"></div>

  <script>
    var initialPosition = null;

    function getLocation(callback) {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          callback(position.coords);
        }, function(error) {
          console.error('Error obtaining location:', error);
          callback(null);
        });
      } else {
        console.error('Geolocation is not supported by this browser.');
        callback(null);
      }
    }

    function calculateDistance(coord1, coord2) {
      if (!coord1 || !coord2) return null;

      var R = 6371e3; // metres
      var φ1 = coord1.latitude * Math.PI/180;
      var φ2 = coord2.latitude * Math.PI/180;
      var Δφ = (coord2.latitude - coord1.latitude) * Math.PI/180;
      var Δλ = (coord2.longitude - coord1.longitude) * Math.PI/180;

      var a = Math.sin(Δφ/2) * Math.sin(Δφ/2) +
              Math.cos(φ1) * Math.cos(φ2) *
              Math.sin(Δλ/2) * Math.sin(Δλ/2);
      var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

      var d = R * c;

      return d; // in metres
    }

    function updateStatus(event) {
      var statusElement = document.getElementById('status');
      var logElement = document.getElementById('log');
      var dateTime = new Date().toLocaleString();
      var status = navigator.onLine ? 'Connected' : 'Disconnected';
      var className = navigator.onLine ? 'online' : 'offline';

      getLocation(function(currentCoords) {
        if (initialPosition === null && currentCoords) {
          initialPosition = currentCoords;
        }

        var distance = null;
        if (currentCoords && initialPosition) {
          distance = calculateDistance(initialPosition, currentCoords);
        }

        var distanceText = distance !== null ? 'Distance from start: ' + distance.toFixed(2) + ' meters' : 'Distance data not available';

        statusElement.textContent = status;
        statusElement.className = className;
        logElement.innerHTML += '<div class="' + className + '">[' + dateTime + '] ' + status + ' - ' + distanceText + '</div>';
        logElement.scrollTop = logElement.scrollHeight;
      });
    }

    window.addEventListener('load', function() {
      updateStatus();
    });
    window.addEventListener('online', updateStatus);
    window.addEventListener('offline', updateStatus);
  </script>
</body>
</html>
